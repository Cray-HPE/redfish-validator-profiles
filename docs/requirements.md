# BMC & Node Functional and Quality Requirements


### Version 

Current version of file: `v1.2.0`

| Date  |  Author | Content  |
|---|---|---|
|  2022-02-08 | Andrew Nieuwsma  | Initial Draft  |
| 2022-02-10 | Andrew Nieuwsma | Published version 1.0.1 |
| 2022-04-07 | Andrew Nieuwsma | Updated to add additional functional requirements |
| 2022-05-13 | Andrew Nieuwsma | Updated requirements based on vendor feedback |


## Overview

This document describes the functional and quality requirements that CSM expects any Redfish based BMC (baseboard management controller) controlling nodes to support.  This document is intended to give objective measurable requirements that correspond with the [profiles](../profiles/) listed.

Some of these requirements transcend BMC requirements and relate to the interconnection between BMC and nodes. 

## Definitions:

1. Redfish - Protocol developed by [DMTF](https://www.dmtf.org/standards/redfish)
2. BMC - Baseboard Management Controller, hereafter referred to as the 'BMC', this entity provides the Redfish interface and controls the node.
3. Node - the hardware component that is controlled by the BMC, hereafter referred to as the 'node'.
4. Customer - The Cray System Management (CSM) services is the consumer of the Redfish API hosted on BMCs.  The customer refers to CSM and its usage pertaining to the Redfish APIs on the BMC.


## Functional Requirements

| Date |  ID  |  Requirement | Notes  |
|---|---|---|---|
| 2022-05-13 |  FR1 | The BMC shall support the paths, parameters, and capabilities specified in the [profiles](../profiles/) listing.   Here is a restatement of some of the core support requirements: The BMC shall at a minimum support: <ol><li>Power actions of the node and the BMC</li><li>Firmware inventory/update of the node and the BMC </li><li>Redfish Alerts and Events</li><li>streamed telemetry </li><li>power capping of the node.</li></ol> | The Customer has specified a minimum set of Redfish API requirements needed to support its operation. The profiles validate the schema. |
| 2022-02-08 | FR2 | The BMC shall send power alerts regardless of the underlying cause of the power event.  This means that a power alert shall be sent if a human actor, IPMI instruction, or Redfish instruction initiates the power event. | It is crucial to the Customer operations that all power events, regardless of origination are sent so the Customer can manage the system. |
| 2022-02-08 | FR3 | When the BMC reports a power status in response to a request to change status (e.g. a power-on is issued), the BMC shall follow through with the request.  This means that if you respond that a power-on event is occurring, that event shall occur. In no case shall the BMC respond that it is completing a power action if it is unable to do so. | We have seen Redfish implementations that exhibit the following incorrect behavior: <ol><li>The power off is issued to all nodes under the BMC.</li><li> Once all nodes have completed the power off (determined via a poll of power status), a power on is issued to all nodes with no wait time.</li><li>If not enough wait time is given, the nodes will complete the posted power on command but not power on.</li></oi>  |
| 2022-02-08 | FR4 | The BMC shall expose an endpoint to set the NTP server to sync time on the BMC. The BMC shall synchronize this time to the nodes it controls.  |  |
| 2022-05-13 | FR5 | Every ethernet port shall have exactly one mac-address.  In no case shall the BMC and node share the same ethernet port. Each BMC shall have a dedicated ethernet port. | Customer discovery process depends upon MAC address based discovery. Multiplexing MACs on ethernet ports hinders customer discovery. |
| 2022-02-08 | FR6 | The BMC shall support a means of setting the boot order for the node via Redfish.  The default boot order shall persist across boot attempts. | |
| 2022-02-08 | FR7 | The BMC shall support communication via HTTP and HTTPS.  | |
| 2022-02-08 | FR8 | The BMC shall support both sessions and basic-auth as the primary authentication method. | The customer relies almost exclusively on basic-auth. All expectations for performance are predicated on all communication being via basic-auth and not sessions. |
| 2022-02-08 | FR9 | The node(s) connected to the BMC shall rerun boot options if the boot fails.   It shall not be acceptable for the node to fall into UEFI shell prompt and not retry the other boot options. | We want to be able to set and disable boot options via redifsh.  If all boot methods fail we expect the entire set to be retried in order. |
| 2022-05-13 | FR10 | HPE requires the ability to load a symmetric key pair and certificate into the BMC via the redfish interface.  The key pair will be generated by HPE.  The BMC should use the keypair and certificate for TLD communication on the BMC. ||| 
| 2022-04-07 | FR11 | The BMC shall not have any pre-configured, well known, administrative accounts credentials.  Each BMC device shall have a randomized high entropy password. | It will not be acceptable for any BMC to come with a preconfigured admin account, whose password is shared by another other BMC from the same manufacturer. i.e. do not create an administrator account like: `admin:password` as this is inherently insecure.  Instead each device shipped should include a randomized password for each device.  The default credential should be documented on a pull-out-card on the physical device, or could be set to a unique identifier for the device, like it's serial number. |
| 2022-04-07 | FR12 | The vendor must include documentation on how to factory reset the BMC to factory defaults, assuming physical access to the device, but not assuming that we have the password. | We will take a low-trust approach to BMC setup and configuration. We would like a way to factory reset the device without having to know the credential of the device; we expect that this would required physical access.  When we receive a device we will factory reset it, use the credential provided on the pull-out-card to access the device, then we will reset the administrator credential so that the pull-out-card is no longer valid without a factory reset. This is ensure no unauthorized access to the device is possible. |
| 2022-04-07 | FR13 | If the computes nodes managed by the BMCs have GPU accelerators, the GPU information needs to be present in the redfish tree. GPU information (serial number, manufacturer, part number, model identifier, processror type) needs to be present in the 'processor' tree:  `/redfish/v1/Systems/<sysid>/Processors`. | We depend on a fully populated redfish tree in order to do FRU (field replaceable unit) tracking.  GPU information must show up in the `Processesor` tree, as opposed to only in the `PCIe` devices tree. |


## Performance and Quality of Service Requirements

Assumptions:
1. all communication from the customer to the BMC shall be over HTTP/HTTPS using basic-auth
2. the customer shall take responsibility to prevent DoS attacks on the system at large. 
3. HPE will provide documentation and references to available testing tools.

|  ID  |  Requirement | Notes  |
|---|---|---|
| PR1 | The BMC shall service continuous sustained Redfish connections (via basic-auth) of at minimum 30 requests per minute. If this rate is exceeded, except by the peak load clause, the server shall be able to delay response times. The server shall not refuse connections.  | The requests will be fanned out across the minute in a evenly fashion.  |
| PR2 | The BMC shall service a peak load of burst connections as defined as: 100 requests in a single minute (via basic-auth) for a duration of 1 minute, before returning to the continuous sustained load previously defined. If this rate is exceeded the server shall be able to delay response times. The server shall not refuse connections.| The requests will be fanned out across the minute in a evenly fashion. |
| PR3 | The BMC shall support at least 10 simultaneous connections via Redfish. | |
| PR4 | The `response time` - total time for server to respond to client after connection, to any endpoint in the Redfish tree on the BMC shall take no longer than `30 seconds`.| |
| PR5 | The BMC shall not categorize repeated connections from the same IP as a DoS attempt. | The customer depends heavily on Redfish connectivity, it is not correct for the BMC to treat this behavior as a DoS attempt. The vendor may either provide a Redfish mechanism to disable DOS prevention, or set the DOS threshold to a traffic pattern of greater than 200 requests per minute (which is above HPE's expresses performance requirement)..|
| PR6 | The Redfish interface of the BMC shall have an availability of at least 99.9%. | HPE will provide a tool that will test repeated Redfish requests of 30/min over a 24 hour time period.  Availability will be measured by request completion ratio, and response latency ratio of 99.9%. Latency will be measured by total response time.|
| PR7 | The freshness of streamed telemetry shall be no less than `0.1 hertz` for any datum. | The customer depends on fresh environmental telemetry to make operational decisions.  Having a minimum resolution of `0.1 hertz` is crucial to providing timely insights. |
